<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Organizer</title>
  <link rel="stylesheet" type="text/css" href="/css/style.x19257.css"/>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.1.js"
        integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI="
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://raw.githubusercontent.com/google/palette.js/master/palette.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js"></script>
<div align="center" id="divChart">
  <canvas id="canvas" width="800" height="800"></canvas>
</div>
<script th:src="@{/js/jquery-1.6.2.js}" type="text/javascript"></script>
<script>
  $(document).ready ( function(){
    graphCreate();
  });
  function graphCreate() {
    $.ajax({
      type : "GET",
      url : window.location + "api/towncount/all",
      success: function (result) {
        $("#postResultDiv").html("" + result.data + "");
        const obj = JSON.parse(result.data);
        const labels = obj.map(function (e) {
          return e[1];
        });

        const backgroundcolor = [];
        for (i = 0; i < labels.length; i++) {
          const r = Math.floor(Math.random() * 255);
          const g = Math.floor(Math.random() * 255);
          const b = Math.floor(Math.random() * 255);
          backgroundcolor.push('rgba(' + r + ', ' + g + ', ' + b + ', 1.0)');
        }
        console.log(labels);
        const data = obj.map(function (e) {
          return e[0];
        });

        const ctx = canvas.getContext('2d');
        const config = {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: 'Статистика сообщений',
              backgroundColor: backgroundcolor,
              data: data,
            }]
          },
          options: {
            responsive: false,
          },
        };

        const chart = new Chart(ctx, config);
      },
      error: function (result) {
        console.log('something went wrong')
      }
    });
  }
</script>
<h1>Organizer</h1>
<h3>Add task to list</h3>
<div class="col-sm-7" id="postResultDiv"></div>
<form action="/add" method="post">
  <table border="1px">
    <tr>
      <td>
        <label>Priority</label>
        <input type="number" name="priorityId">
      </td>
      <td>
        <label>Description</label>
        <input type="text" name="description">
      </td>
      <td>
        <label>Date</label>
        <input type="date" name="date">
      </td>

      <td>
        <input type="submit" value="add task">
      </td>

    </tr>

  </table>
</form>
<br>
<table border="1px">
  <tr>
    <td>Город</td>
    <td>Количество специальностей</td>
  </tr>
  <tr th:each="tC : ${townCount}">
    <td th:text="${tC[1]}"></td>
    <td th:text="${tC[0]}"></td>
  </tr>
</table>
</body>
</html>